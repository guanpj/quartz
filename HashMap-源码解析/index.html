<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="å‰è¨€ HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨ K-V å®¹å™¨ï¼Œä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ å­˜å‚¨çš„ä½ç½®ï¼ŒHashMap å¯¹ Entry è¿›è¡Œäº†æ‰©å±•ï¼ˆNodeï¼‰ï¼Œä½¿å…¶å½¢æˆä»¥é“¾è¡¨æˆ–è€…æ ‘çš„å½¢å¼å­˜å‚¨åœ¨ HashMap çš„å®¹å™¨é‡Œã€‚
åœ¨ Java 8 ä¹‹å‰å’Œä¹‹åï¼ŒHashMap çš„å®ç°æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œå› æ­¤å¯¹äº put æµç¨‹ã€æ‰©å®¹æœºåˆ¶ç­‰ä¸»è¦è¿‡ç¨‹åˆ†æå°†ä¼šé‡‡ç”¨ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ã€‚
æˆå‘˜å˜é‡ HashMap æˆå‘˜å˜é‡å’Œæ„é€ æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼ˆJava 7 å’Œ 8 å¤§è‡´ç›¸åŒï¼Œä»¥ä¸‹ä¸º Java 8 ç‰ˆæœ¬ï¼‰ï¼š"><meta property="og:title" content="HashMap æºç è§£æ"><meta property="og:description" content="å‰è¨€ HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨ K-V å®¹å™¨ï¼Œä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ å­˜å‚¨çš„ä½ç½®ï¼ŒHashMap å¯¹ Entry è¿›è¡Œäº†æ‰©å±•ï¼ˆNodeï¼‰ï¼Œä½¿å…¶å½¢æˆä»¥é“¾è¡¨æˆ–è€…æ ‘çš„å½¢å¼å­˜å‚¨åœ¨ HashMap çš„å®¹å™¨é‡Œã€‚
åœ¨ Java 8 ä¹‹å‰å’Œä¹‹åï¼ŒHashMap çš„å®ç°æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œå› æ­¤å¯¹äº put æµç¨‹ã€æ‰©å®¹æœºåˆ¶ç­‰ä¸»è¦è¿‡ç¨‹åˆ†æå°†ä¼šé‡‡ç”¨ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ã€‚
æˆå‘˜å˜é‡ HashMap æˆå‘˜å˜é‡å’Œæ„é€ æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼ˆJava 7 å’Œ 8 å¤§è‡´ç›¸åŒï¼Œä»¥ä¸‹ä¸º Java 8 ç‰ˆæœ¬ï¼‰ï¼š"><meta property="og:type" content="website"><meta property="og:image" content="https://www.guanpj.top/icon.png"><meta property="og:url" content="https://www.guanpj.top/HashMap-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="HashMap æºç è§£æ"><meta name=twitter:description content="å‰è¨€ HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨ K-V å®¹å™¨ï¼Œä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ å­˜å‚¨çš„ä½ç½®ï¼ŒHashMap å¯¹ Entry è¿›è¡Œäº†æ‰©å±•ï¼ˆNodeï¼‰ï¼Œä½¿å…¶å½¢æˆä»¥é“¾è¡¨æˆ–è€…æ ‘çš„å½¢å¼å­˜å‚¨åœ¨ HashMap çš„å®¹å™¨é‡Œã€‚
åœ¨ Java 8 ä¹‹å‰å’Œä¹‹åï¼ŒHashMap çš„å®ç°æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œå› æ­¤å¯¹äº put æµç¨‹ã€æ‰©å®¹æœºåˆ¶ç­‰ä¸»è¦è¿‡ç¨‹åˆ†æå°†ä¼šé‡‡ç”¨ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ã€‚
æˆå‘˜å˜é‡ HashMap æˆå‘˜å˜é‡å’Œæ„é€ æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼ˆJava 7 å’Œ 8 å¤§è‡´ç›¸åŒï¼Œä»¥ä¸‹ä¸º Java 8 ç‰ˆæœ¬ï¼‰ï¼š"><meta name=twitter:image content="https://www.guanpj.top/icon.png"><meta name=twitter:site content="guanpj"><title>HashMap æºç è§£æ</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://www.guanpj.top//icon.png><link href=https://www.guanpj.top/styles.0452046239b15cdfa822e3a8fa41b16d.min.css rel=stylesheet><link href=https://www.guanpj.top/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://www.guanpj.top/js/darkmode.b65338f159f3469fa8b9dc7675293fba.min.js></script>
<script src=https://www.guanpj.top/js/util.a0ccf91e1937fe761a74da4946452710.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script async src=https://www.guanpj.top/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://www.guanpj.top/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://www.guanpj.top/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://www.guanpj.top/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://www.guanpj.top/",fetchData=Promise.all([fetch("https://www.guanpj.top/indices/linkIndex.cf6439e057b2800c40a018b5e420d51c.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://www.guanpj.top/indices/contentIndex.096017a54b289f29dbbc214dcf7d122d.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://www.guanpj.top",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://www.guanpj.top",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/www.guanpj.top\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=www.guanpj.top src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://www.guanpj.top/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://www.guanpj.top/>ğŸŒ» guanpjã®èŠ±å›­ ğŸŒµ</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>HashMap æºç è§£æ</h1><p class=meta>Last updated
Mar 22, 2023</p><ul class=tags><li><a href=https://www.guanpj.top/tags/HashMap/>Hash map</a></li><li><a href=https://www.guanpj.top/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/>æºç è§£æ</a></li><li><a href=https://www.guanpj.top/tags/Java/>Java</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#æˆå‘˜å˜é‡>æˆå‘˜å˜é‡</a></li><li><a href=#æ•°æ®ç»“æ„>æ•°æ®ç»“æ„</a></li><li><a href=#put-æµç¨‹åˆ†æ>put æµç¨‹åˆ†æ</a><ol><li><a href=#java-7-put-æµç¨‹>Java 7 put æµç¨‹</a><ol><li><a href=#ä»£ç åˆ†æ>ä»£ç åˆ†æ</a></li><li><a href=#æµç¨‹å›¾ç¤º>æµç¨‹å›¾ç¤º</a></li></ol></li><li><a href=#java-8-put-æµç¨‹>Java 8 put æµç¨‹</a><ol><li><a href=#ä»£ç åˆ†æ-1>ä»£ç åˆ†æ</a><ol><li><a href=#æµç¨‹å›¾ç¤º-1>æµç¨‹å›¾ç¤º</a></li></ol></li></ol></li></ol></li><li><a href=#hash-è®¡ç®—ä¸å…ƒç´ ä½ç½®ç¡®å®š>hash è®¡ç®—ä¸å…ƒç´ ä½ç½®ç¡®å®š</a><ol><li><a href=#java-7>Java 7</a></li><li><a href=#java-8>Java 8</a></li></ol></li><li><a href=#æ‰©å®¹æµç¨‹>æ‰©å®¹æµç¨‹</a><ol><li><a href=#java-7-æ‰©å®¹æµç¨‹>Java 7 æ‰©å®¹æµç¨‹</a><ol><li><a href=#ä»£ç åˆ†æ-2>ä»£ç åˆ†æ</a></li><li><a href=#æ‰©å®¹æµç¨‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæ‚£>æ‰©å®¹æµç¨‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæ‚£</a></li></ol></li><li><a href=#java-8-æ‰©å®¹æµç¨‹>Java 8 æ‰©å®¹æµç¨‹</a><ol><li><a href=#ä»£ç åˆ†æ-3>ä»£ç åˆ†æ</a></li></ol></li><li><a href=#æ‰©å®¹æµç¨‹å¯¹æ¯”>æ‰©å®¹æµç¨‹å¯¹æ¯”</a></li></ol></li><li><a href=#get-æµç¨‹åˆ†æ>get æµç¨‹åˆ†æ</a><ol><li><a href=#java-7-1>Java 7</a></li><li><a href=#java-8-1>Java 8</a></li></ol></li><li><a href=#é¢è¯•é¢˜>é¢è¯•é¢˜</a><ol><li><a href=#ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„é•¿åº¦ä¸º-2-çš„å¹‚æ¬¡æ–¹>ä¸ºä»€ä¹ˆ HashMap æ•°ç»„é•¿åº¦ä¸º 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿ</a></li><li><a href=#hash-å†²çªæœ‰å“ªäº›è§£å†³æ–¹æ³•hashmap-æ˜¯æ€æ ·è§£å†³çš„>hash å†²çªæœ‰å“ªäº›è§£å†³æ–¹æ³•ï¼ŸHashMap æ˜¯æ€æ ·è§£å†³çš„ï¼Ÿ</a></li><li><a href=#hashmap-ä¼šé€ æˆå“ªäº›å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³>HashMap ä¼šé€ æˆå“ªäº›å®‰å…¨é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</a></li><li><a href=#ä½¿ç”¨å¯¹è±¡ä½œä¸º-hashmap-çš„-key-åº”è¯¥æ³¨æ„ä»€ä¹ˆ>ä½¿ç”¨å¯¹è±¡ä½œä¸º HashMap çš„ key åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿ</a></li></ol></li></ol></nav></details></aside><a href=#å‰è¨€><h1 id=å‰è¨€><span class=hanchor arialabel=Anchor># </span>å‰è¨€</h1></a><p>HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨ K-V å®¹å™¨ï¼Œä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ å­˜å‚¨çš„ä½ç½®ï¼ŒHashMap å¯¹ Entry è¿›è¡Œäº†æ‰©å±•ï¼ˆNodeï¼‰ï¼Œä½¿å…¶å½¢æˆä»¥é“¾è¡¨æˆ–è€…æ ‘çš„å½¢å¼å­˜å‚¨åœ¨ HashMap çš„å®¹å™¨é‡Œã€‚</p><p>åœ¨ Java 8 ä¹‹å‰å’Œä¹‹åï¼ŒHashMap çš„å®ç°æœ‰è¾ƒå¤§çš„ä¸åŒï¼Œå› æ­¤å¯¹äº put æµç¨‹ã€æ‰©å®¹æœºåˆ¶ç­‰ä¸»è¦è¿‡ç¨‹åˆ†æå°†ä¼šé‡‡ç”¨ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ã€‚</p><a href=#æˆå‘˜å˜é‡><h1 id=æˆå‘˜å˜é‡><span class=hanchor arialabel=Anchor># </span>æˆå‘˜å˜é‡</h1></a><p>HashMap æˆå‘˜å˜é‡å’Œæ„é€ æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼ˆJava 7 å’Œ 8 å¤§è‡´ç›¸åŒï¼Œä»¥ä¸‹ä¸º Java 8 ç‰ˆæœ¬ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span>Â <span class=kd>class</span>Â <span class=nc>HashMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span>Â <span class=kd>extends</span>Â <span class=n>AbstractMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>implements</span>Â <span class=n>Map</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;,</span>Â <span class=n>Cloneable</span><span class=o>,</span>Â <span class=n>Serializable</span>Â <span class=o>{</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åˆå§‹å®¹é‡ 16  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>int</span>Â <span class=n>DEFAULT_INITIAL_CAPACITY</span>Â <span class=o>=</span>Â <span class=n>1</span>Â <span class=o>&lt;&lt;</span>Â <span class=n>4</span><span class=o>;</span>Â <span class=c1>//Â akaÂ 16  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æœ€å¤§å®¹é‡ï¼Œè¯¥æ•°ç»„æœ€å¤§å€¼ä¸º2^31ä¸€æ¬¡æ–¹ã€‚  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>int</span>Â <span class=n>MAXIMUM_CAPACITY</span>Â <span class=o>=</span>Â <span class=n>1</span>Â <span class=o>&lt;&lt;</span>Â <span class=n>30</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// é»˜è®¤çš„åŠ è½½å› å­ï¼Œå¦‚æœæ„é€ çš„æ—¶å€™ä¸ä¼ åˆ™ä¸º 0.75  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>float</span>Â <span class=n>DEFAULT_LOAD_FACTOR</span>Â <span class=o>=</span>Â <span class=n>0</span><span class=o>.</span><span class=na>75f</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>//Â @1.8ï¼šæ•°ç»„æŸä¸ªä½ç½®ä¸‹çš„ node é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹è¯¥é“¾è¡¨çš„æœ€å°é•¿åº¦è¦æ±‚  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>int</span>Â <span class=n>TREEIFY_THRESHOLD</span>Â <span class=o>=</span>Â <span class=n>8</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// @1.8ï¼šå½“ä¸€ä¸ªåæ ‘åŒ–çš„é˜ˆå€¼ï¼Œå½“è¿™ä¸ª node é•¿åº¦å‡å°‘åˆ°è¯¥å€¼å°±ä¼šä»æ ‘è½¬åŒ–æˆé“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>int</span>Â <span class=n>UNTREEIFY_THRESHOLD</span>Â <span class=o>=</span>Â <span class=n>6</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// @1.8ï¼šæ•°ç»„æŸä¸ªä½ç½®ä¸‹çš„ node é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹å…ƒç´ ä¸ªæ•°çš„æœ€å°è¦æ±‚  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>static</span>Â <span class=kd>final</span>Â <span class=kt>int</span>Â <span class=n>MIN_TREEIFY_CAPACITY</span>Â <span class=o>=</span>Â <span class=n>64</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å…·ä½“å­˜æ”¾æ•°æ®çš„æ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>transient</span>Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span>Â <span class=n>table</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// entrySetï¼Œä¸€ä¸ªå­˜æ”¾ k-v ç¼“å†²åŒº  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>transient</span>Â <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;&gt;</span>Â <span class=n>entrySet</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å­˜æ”¾é”®å€¼å¯¹çš„ä¸ªæ•°ã€‚  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>transient</span>Â <span class=kt>int</span>Â <span class=n>size</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è®°å½•æ›´æ”¹ map ç»“æ„æ¬¡æ•°(æ·»åŠ ã€åˆ é™¤ã€æ‰©å®¹ï¼Ÿ)  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>transient</span>Â <span class=kt>int</span>Â <span class=n>modCount</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// ä¸´ç•Œå€¼ï¼Œå½“å®é™…å¤§å°(å®¹é‡*å¡«å……å› å­)è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>threshold</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¡«å……å› å­  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>final</span>Â <span class=kt>float</span>Â <span class=n>loadFactor</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æŒ‡å®šåˆå§‹å®¹é‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>public</span>Â <span class=nf>HashMap</span><span class=o>(</span><span class=kt>int</span>Â <span class=n>initialCapacity</span><span class=o>)</span>Â <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>(</span><span class=n>initialCapacity</span><span class=o>,</span>Â <span class=n>DEFAULT_LOAD_FACTOR</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// é»˜è®¤æ„é€ å‡½æ•°  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>public</span>Â <span class=nf>HashMap</span><span class=o>()</span>Â <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// é»˜è®¤ threshold åœ¨é¦–æ¬¡ put æ—¶æ‰å¤åˆ¶ï¼ŒJava 7 åˆ™æ˜¯è°ƒç”¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=c1>// this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR)  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>loadFactor</span>Â <span class=o>=</span>Â <span class=n>DEFAULT_LOAD_FACTOR</span><span class=o>;</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åŒ…å«å¦ä¸€ä¸ª Map  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>public</span>Â <span class=nf>HashMap</span><span class=o>(</span><span class=n>Map</span><span class=o>&lt;?</span>Â <span class=kd>extends</span>Â <span class=n>K</span><span class=o>,</span>Â <span class=o>?</span>Â <span class=kd>extends</span>Â <span class=n>V</span><span class=o>&gt;</span>Â <span class=n>m</span><span class=o>)</span>Â <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>loadFactor</span>Â <span class=o>=</span>Â <span class=n>DEFAULT_LOAD_FACTOR</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>putMapEntries</span><span class=o>(</span><span class=n>m</span><span class=o>,</span>Â <span class=kc>false</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æŒ‡å®šåˆå§‹å®¹é‡å’Œå¡«å……å› å­  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kd>public</span>Â <span class=nf>HashMap</span><span class=o>(</span><span class=kt>int</span>Â <span class=n>initialCapacity</span><span class=o>,</span>Â <span class=kt>float</span>Â <span class=n>loadFactor</span><span class=o>)</span>Â <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span>Â <span class=o>(</span><span class=n>initialCapacity</span>Â <span class=o>&lt;</span>Â <span class=n>0</span><span class=o>)</span>Â <span class=c1>//Â å®¹é‡ä¸èƒ½ä¸ºè´Ÿæ•°  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>throw</span>Â <span class=k>new</span>Â <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;IllegalÂ initialÂ capacity:Â &#34;</span>Â <span class=o>+</span> <span class=n>initialCapacity</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// å½“å®¹é‡å¤§äº 2^31 å°±å–æœ€å¤§å€¼ 1&lt;&lt;30;Â   
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span>Â <span class=o>(</span><span class=n>initialCapacity</span>Â <span class=o>&gt;</span>Â <span class=n>MAXIMUM_CAPACITY</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>initialCapacity</span>Â <span class=o>=</span>Â <span class=n>MAXIMUM_CAPACITY</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span>Â <span class=o>(</span><span class=n>loadFactor</span>Â <span class=o>&lt;=</span>Â <span class=n>0</span>Â <span class=o>||</span>Â <span class=n>Float</span><span class=o>.</span><span class=na>isNaN</span><span class=o>(</span><span class=n>loadFactor</span><span class=o>))</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>throw</span>Â <span class=k>new</span>Â <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;IllegalÂ loadÂ factor:Â &#34;</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>+</span> <span class=n>loadFactor</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>loadFactor</span>Â <span class=o>=</span>Â <span class=n>loadFactor</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>//Â tableSizeFor ä¿è¯äº†æ•°ç»„é•¿åº¦ä¸€å®šæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œæ˜¯å¤§äºç­‰äºÂ Â Â Â initialCapacity æœ€æ¥è¿‘çš„å€¼ã€‚  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=c1>// è¿™é‡Œä½¿ç”¨ threshold æš‚æ—¶ä¿å­˜è®¡ç®—åçš„ initialCapacity å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>threshold</span>Â <span class=o>=</span>Â <span class=n>tableSizeFor</span><span class=o>(</span><span class=n>initialCapacity</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>...</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#æ•°æ®ç»“æ„><h1 id=æ•°æ®ç»“æ„><span class=hanchor arialabel=Anchor># </span>æ•°æ®ç»“æ„</h1></a><p>Java 7 é‡‡ç”¨æ•°ç»„ + é“¾è¡¨æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå…ƒç´ ç±»å‹ä¸º Entryï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=kd>implements</span> <span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>final</span> <span class=n>K</span> <span class=n>key</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>V</span> <span class=n>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>hash</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>...</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><p>å…ƒç´ çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹ï¼š<br><img src=https://my-bucket-1251125515.cos.ap-guangzhou.myqcloud.com/HashMap/clipboard_20230322_035018.png width=auto alt>
Java 8 å¼€å§‹ï¼Œé‡‡ç”¨æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå…ƒç´ ç±»å‹ä¸º Node å’Œ TreeNodeï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=kd>implements</span> <span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>final</span> <span class=kt>int</span> <span class=n>hash</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>final</span> <span class=n>K</span> <span class=n>key</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>V</span> <span class=n>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>...</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>LinkedHashMap</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>parent</span><span class=o>;</span>Â Â <span class=c1>// red-black tree links  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>left</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>right</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>prev</span><span class=o>;</span>Â Â Â Â <span class=c1>// needed to unlink next upon deletion  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>boolean</span> <span class=n>red</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â 
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>...</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><p>å…ƒç´ çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹ï¼š
<img src=https://my-bucket-1251125515.cos.ap-guangzhou.myqcloud.com/HashMap/clipboard_20230322_041741.png width=auto alt></p><a href=#put-æµç¨‹åˆ†æ><h1 id=put-æµç¨‹åˆ†æ><span class=hanchor arialabel=Anchor># </span>put æµç¨‹åˆ†æ</h1></a><a href=#java-7-put-æµç¨‹><h2 id=java-7-put-æµç¨‹><span class=hanchor arialabel=Anchor># </span>Java 7 put æµç¨‹</h2></a><a href=#ä»£ç åˆ†æ><h3 id=ä»£ç åˆ†æ><span class=hanchor arialabel=Anchor># </span>ä»£ç åˆ†æ</h3></a><p>Java 7 put æµç¨‹ä¸»è¦æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>table</span> <span class=o>==</span> <span class=n>EMPTY_TABLE</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// åˆå§‹åŒ– table  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>inflateTable</span><span class=o>(</span><span class=n>threshold</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// åœ¨ table[0] å¤„æ’å…¥ key ä¸º null å…ƒç´ å¹¶è¿”å›  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>putForNullKey</span><span class=o>(</span><span class=n>value</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å…ˆè¿›è¡Œä¸€æ¬¡ hash è®¡ç®—Â Â Â   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>int</span> <span class=n>hash</span> <span class=o>=</span> <span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ ¹æ® hash å€¼è®¡ç®— table ä¸‹æ ‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>indexFor</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>table</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// éå† table[i] å¤„çš„é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>table</span><span class=o>[</span><span class=n>i</span><span class=o>];</span> <span class=n>e</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>Object</span> <span class=n>k</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// hash ä¸€æ ·ä¸” key ç›¸ç­‰æˆ–è€… equals æ–¹æ³•è¿”å› true æ‰è¿›è¡Œæ›¿æ¢  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span> <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>)))</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>recordAccess</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>oldValue</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å‡ºå¾ªç¯æ„å‘³ç€ table[i] è¿™æ¡é“¾è¡¨æ²¡æœ‰æ­¤å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=c1>// æ›´æ–° modCount  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>modCount</span><span class=o>++;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ’å…¥æ–°å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>addEntry</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=n>i</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>inflateTable</span><span class=o>(</span><span class=kt>int</span> <span class=n>toSize</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è·å–å¤§äº  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>int</span> <span class=n>capacity</span> <span class=o>=</span> <span class=n>roundUpToPowerOf2</span><span class=o>(</span><span class=n>toSize</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// é‡æ–°è®¡ç®—é˜ˆå€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>threshold</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>Math</span><span class=o>.</span><span class=na>min</span><span class=o>(</span><span class=n>capacity</span> <span class=o>*</span> <span class=n>loadFactor</span><span class=o>,</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>MAXIMUM_CAPACITY</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åˆ›å»ºæ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>table</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Entry</span><span class=o>[</span><span class=n>capacity</span><span class=o>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ ¹æ®é…ç½®åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ– hashSeed  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>initHashSeedAsNeeded</span><span class=o>(</span><span class=n>capacity</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>V</span> <span class=nf>putForNullKey</span><span class=o>(</span><span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æœ€å¤šå¾ªç¯ä¸€æ¬¡ï¼Œå› ä¸ºè¿™ä¸ªä½ç½®æœ€å¤šåªæœ‰ä¸€ä¸ªå…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>table</span><span class=o>[</span><span class=n>0</span><span class=o>];</span> <span class=n>e</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// key ä¸º null ç›´æ¥æ›¿æ¢  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>recordAccess</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>oldValue</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ›´æ–° modCount  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>modCount</span><span class=o>++;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åœ¨ table[0] å¤„æ’å…¥å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>addEntry</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=n>0</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>addEntry</span><span class=o>(</span><span class=kt>int</span> <span class=n>hash</span><span class=o>,</span> <span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>,</span> <span class=kt>int</span> <span class=n>bucketIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å…ƒç´ æ•°é‡è¾¾åˆ°ä¸´ç•Œå€¼ä¸” table[bucketIndex] ä½ç½®ä¸ä¸ºç©ºæ‰è¿›è¡Œæ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=n>threshold</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>table</span><span class=o>[</span><span class=n>bucketIndex</span><span class=o>]))</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// ä¸¤å€å®¹é‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>resize</span><span class=o>(</span><span class=n>2</span> <span class=o>*</span> <span class=n>table</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// é‡æ–°è®¡ç®— hash  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>hash</span> <span class=o>=</span> <span class=o>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>key</span><span class=o>)</span> <span class=o>?</span> <span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>)</span> <span class=o>:</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// é‡æ–°ç¡®å®šæ•°ç»„ä¸‹æ ‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>bucketIndex</span> <span class=o>=</span> <span class=n>indexFor</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>table</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åˆ›å»ºå¹¶æ’å…¥æ–°å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>createEntry</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=n>bucketIndex</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=c1>// åœ¨é“¾è¡¨å¤´éƒ¨æ’å…¥æ–°å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>createEntry</span><span class=o>(</span><span class=kt>int</span> <span class=n>hash</span><span class=o>,</span> <span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>,</span> <span class=kt>int</span> <span class=n>bucketIndex</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// ä¿å­˜åŸå¤´ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>table</span><span class=o>[</span><span class=n>bucketIndex</span><span class=o>];</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åˆ›å»ºæ–°å…ƒç´ ã€æŠŠ next æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¹¶æ›¿æ¢åŸæ¥ bucketIndex ä½ç½®çš„é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>table</span><span class=o>[</span><span class=n>bucketIndex</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Entry</span><span class=o>&lt;&gt;(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å…ƒç´ æ•°é‡++  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>size</span><span class=o>++</span><span class=err>ï¼›</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#æµç¨‹å›¾ç¤º><h3 id=æµç¨‹å›¾ç¤º><span class=hanchor arialabel=Anchor># </span>æµç¨‹å›¾ç¤º</h3></a><p><img src=https://my-bucket-1251125515.cos.ap-guangzhou.myqcloud.com/HashMap/clipboard_20230322_040358.png width=auto alt></p><a href=#java-8-put-æµç¨‹><h2 id=java-8-put-æµç¨‹><span class=hanchor arialabel=Anchor># </span>Java 8 put æµç¨‹</h2></a><a href=#ä»£ç åˆ†æ-1><h3 id=ä»£ç åˆ†æ-1><span class=hanchor arialabel=Anchor># </span>ä»£ç åˆ†æ</h3></a><p>Java 8 put æµç¨‹ä¸»è¦æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â <span class=c1>// onlyIfAbsent é»˜è®¤ä¸º falseï¼Œå³å…ƒç´ å­˜åœ¨æ—¶è¿›è¡Œæ›¿æ¢  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>return</span> <span class=n>putVal</span><span class=o>(</span><span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>),</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=kc>false</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=n>V</span> <span class=nf>putVal</span><span class=o>(</span><span class=kt>int</span> <span class=n>hash</span><span class=o>,</span> <span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>,</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â <span class=kt>boolean</span> <span class=n>onlyIfAbsent</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>evict</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=n>tab</span><span class=o>;</span> <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>p</span><span class=o>;</span> <span class=kt>int</span> <span class=n>n</span><span class=o>,</span> <span class=n>i</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// table æœªåˆå§‹åŒ–æˆ–è€…é•¿åº¦ä¸º 0ï¼Œè¿›è¡Œæ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>tab</span> <span class=o>=</span> <span class=n>table</span><span class=o>)</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=o>(</span><span class=n>n</span> <span class=o>=</span> <span class=n>tab</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>n</span> <span class=o>=</span> <span class=o>(</span><span class=n>tab</span> <span class=o>=</span> <span class=n>resize</span><span class=o>()).</span><span class=na>length</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// (n - 1) &amp; hash ç¡®å®šå…ƒç´ å­˜æ”¾ä½ç½®ï¼Œä½ç½®ä¸ºç©ºåˆ™ç›´æ¥æ”¾å…¥è¯¥ä½ç½®  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>p</span> <span class=o>=</span> <span class=n>tab</span><span class=o>[</span><span class=n>i</span> <span class=o>=</span> <span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>)</span> <span class=o>&amp;</span> <span class=n>hash</span><span class=o>])</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>tab</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>newNode</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ•°ç»„å¯¹åº”ä½ç½®å·²ç»å­˜åœ¨å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span><span class=o>;</span> <span class=n>K</span> <span class=n>k</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// æ¯”è¾ƒæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>p</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span> <span class=o>(</span><span class=n>key</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>))))</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// å°†ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™ e  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span> <span class=o>=</span> <span class=n>p</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// æ˜¯å¦ä¸ºçº¢é»‘æ ‘ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>p</span> <span class=k>instanceof</span> <span class=n>TreeNode</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// æ”¾å…¥æ ‘ä¸­  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span> <span class=o>=</span> <span class=o>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;)</span><span class=n>p</span><span class=o>).</span><span class=na>putTreeVal</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=n>tab</span><span class=o>,</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// é“¾è¡¨ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// éå†é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>binCount</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=o>;</span> <span class=o>++</span><span class=n>binCount</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨ï¼Œè¯´æ˜æ²¡æœ‰æ‰¾åˆ°ç›¸ç­‰çš„ key  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åœ¨å°¾éƒ¨æ’å…¥æ–°ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>p</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=n>newNode</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åˆ¤æ–­ç»“ç‚¹æ•°é‡æ˜¯å¦è¾¾åˆ°é˜ˆå€¼(TREEIFY_THRESHOLD é»˜è®¤ä¸º 8)  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>binCount</span> <span class=o>&gt;=</span> <span class=n>TREEIFY_THRESHOLD</span> <span class=o>-</span> <span class=n>1</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// æ ¹æ®æ•°ç»„é•¿åº¦å†³å®šæ˜¯å¦æ ‘åŒ–  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>treeifyBin</span><span class=o>(</span><span class=n>tab</span><span class=o>,</span> <span class=n>hash</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// è·³å‡ºå¾ªç¯  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>break</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„ key å€¼æ˜¯å¦ä¸æ’å…¥çš„ key ç›¸ç­‰  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>(</span><span class=n>key</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>))))</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// key ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶ e å°±æ˜¯ç›®æ ‡ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>break</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// ä¸å‰é¢çš„ e = p.next ç»„åˆéå†é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>p</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// æ‰¾åˆ° key å€¼ç›¸ç­‰çš„ç›®æ ‡ç»“ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// onlyIfAbsent ä¸º false æˆ–è€…ç›®æ ‡æ¥ç‚¹å€¼ä¸º null  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(!</span><span class=n>onlyIfAbsent</span> <span class=o>||</span> <span class=n>oldValue</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>//ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// ç©ºå®ç°ï¼Œç”¨äºè®¿é—®åå›è°ƒç»™å­ç±»ï¼Œå¦‚ LinkedHashMap  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>afterNodeAccess</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// è¿”å›æ—§å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>oldValue</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// ç»“æ„ä¿®æ”¹ï¼Œæ›´æ–° modCount  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=o>++</span><span class=n>modCount</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å®é™…å¤§å°å¤§äºé˜ˆå€¼åˆ™æ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>(++</span><span class=n>size</span> <span class=o>&gt;</span> <span class=n>threshold</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>resize</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ’å…¥åå›è°ƒ  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>afterNodeInsertion</span><span class=o>(</span><span class=n>evict</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#æµç¨‹å›¾ç¤º-1><h4 id=æµç¨‹å›¾ç¤º-1><span class=hanchor arialabel=Anchor># </span>æµç¨‹å›¾ç¤º</h4></a><p><img src=https://my-bucket-1251125515.cos.ap-guangzhou.myqcloud.com/HashMap/clipboard_20230322_040522.png width=auto alt></p><a href=#hash-è®¡ç®—ä¸å…ƒç´ ä½ç½®ç¡®å®š><h1 id=hash-è®¡ç®—ä¸å…ƒç´ ä½ç½®ç¡®å®š><span class=hanchor arialabel=Anchor># </span>hash è®¡ç®—ä¸å…ƒç´ ä½ç½®ç¡®å®š</h1></a><a href=#java-7><h2 id=java-7><span class=hanchor arialabel=Anchor># </span>Java 7</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>int</span> <span class=n>hash</span> <span class=o>=</span> <span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>indexFor</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>table</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=kt>int</span> <span class=nf>hash</span><span class=o>(</span><span class=n>Object</span> <span class=n>k</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// é»˜è®¤ä¸º 0ï¼Œåˆå§‹åŒ–æ–¹æ³•è§åæ–‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>int</span> <span class=n>h</span> <span class=o>=</span> <span class=n>hashSeed</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¦‚æœ hashSeed ä¸ä¸ºé›¶ä¸” key æ˜¯ String ç±»å‹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>0</span> <span class=o>!=</span> <span class=n>h</span> <span class=o>&amp;&amp;</span> <span class=n>k</span> <span class=k>instanceof</span> <span class=n>String</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// è¿”å›ç‰¹å®š hash å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>sun</span><span class=o>.</span><span class=na>misc</span><span class=o>.</span><span class=na>Hashing</span><span class=o>.</span><span class=na>stringHash32</span><span class=o>((</span><span class=n>String</span><span class=o>)</span> <span class=n>k</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>h</span> <span class=o>^=</span> <span class=n>k</span><span class=o>.</span><span class=na>hashCode</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¤šæ¬¡å¼‚æˆ–  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>h</span> <span class=o>^=</span> <span class=o>(</span><span class=n>h</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>20</span><span class=o>)</span> <span class=o>^</span> <span class=o>(</span><span class=n>h</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>12</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=n>h</span> <span class=o>^</span> <span class=o>(</span><span class=n>h</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>7</span><span class=o>)</span> <span class=o>^</span> <span class=o>(</span><span class=n>h</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>4</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kt>int</span> <span class=nf>indexFor</span><span class=o>(</span><span class=kt>int</span> <span class=n>h</span><span class=o>,</span> <span class=kt>int</span> <span class=n>length</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// assert Integer.bitCount(length) == 1 : &#34;length must be a non-zero power of 2&#34;;  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>return</span> <span class=n>h</span> <span class=o>&amp;</span> <span class=o>(</span><span class=n>length</span><span class=o>-</span><span class=n>1</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#java-8><h2 id=java-8><span class=hanchor arialabel=Anchor># </span>Java 8</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=n>putVal</span><span class=o>(</span><span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>),</span> <span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>,</span> <span class=kc>false</span><span class=o>,</span> <span class=kc>true</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=nf>hash</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>h</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è®©é«˜ 16 ä½å’Œä½ 16 ä½å¼‚æˆ–  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>return</span> <span class=o>(</span><span class=n>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=o>(</span><span class=n>h</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=na>hashCode</span><span class=o>())</span> <span class=o>^</span> <span class=o>(</span><span class=n>h</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>16</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>tab</span><span class=o>[</span><span class=n>index</span> <span class=o>=</span> <span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>)</span> <span class=o>&amp;</span> <span class=n>hash</span><span class=o>]</span><span class=err>ï¼›</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#æ‰©å®¹æµç¨‹><h1 id=æ‰©å®¹æµç¨‹><span class=hanchor arialabel=Anchor># </span>æ‰©å®¹æµç¨‹</h1></a><p>æ‰©å®¹è¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</p><p>å’Œæ‰©å®¹ç›¸å…³çš„å…¨å±€å˜é‡åŠå…¶å«ä¹‰ï¼š</p><table><thead><tr><th>å…¨å±€å˜é‡Â Â Â </th><th>å«ä¹‰Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th></tr></thead><tbody><tr><td>capacityÂ Â Â </td><td>table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr><tr><td>sizeÂ Â Â Â Â Â Â </td><td>å­˜æ”¾é”®å€¼å¯¹æ•°é‡ã€‚Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr><tr><td>thresholdÂ Â </td><td>size çš„ä¸´ç•Œå€¼ï¼Œå½“ size å¤§äºç­‰äº threshold å°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚threshold = (int) (capacity * loadFactor)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr><tr><td>loadFactor</td><td>å¡«å……å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ã€‚loadFactor èƒ½å¤Ÿæ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactor è¶Šè¶‹è¿‘äº 1ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±è¶Šå¯†ï¼Œä¹Ÿå°±æ˜¯ä¼šè®©é“¾è¡¨çš„é•¿åº¦å¢åŠ ï¼ŒloadFactor è¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¶‹è¿‘äº 0ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå°‘ï¼Œä¹Ÿå°±è¶Šç¨€ç–ã€‚<br>loadFactor å¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚loadFactor çš„é»˜è®¤å€¼ä¸º 0.75f æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼ã€‚</td></tr></tbody></table><a href=#java-7-æ‰©å®¹æµç¨‹><h2 id=java-7-æ‰©å®¹æµç¨‹><span class=hanchor arialabel=Anchor># </span>Java 7 æ‰©å®¹æµç¨‹</h2></a><a href=#ä»£ç åˆ†æ-2><h3 id=ä»£ç åˆ†æ-2><span class=hanchor arialabel=Anchor># </span>ä»£ç åˆ†æ</h3></a><p>Java 7 çš„ resize æ–¹æ³•ç›¸å…³ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>void</span> <span class=nf>resize</span><span class=o>(</span><span class=kt>int</span> <span class=n>newCapacity</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Entry</span><span class=o>[]</span> <span class=n>oldTable</span> <span class=o>=</span> <span class=n>table</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è®°å½•æ—§å®¹é‡  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>int</span> <span class=n>oldCapacity</span> <span class=o>=</span> <span class=n>oldTable</span><span class=o>.</span><span class=na>length</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¦‚æœå®¹é‡å·²è¾¾åˆ°ä¸Šé™ï¼Œåˆ™æ‰©å®¹é˜ˆå€¼è®¾ç½®æˆä¸å¯èƒ½è¾¾åˆ°çš„æœ€å¤§å€¼ï¼Œå³åç»­ä¸å†æ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>oldCapacity</span> <span class=o>==</span> <span class=n>MAXIMUM_CAPACITY</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>threshold</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>MAX_VALUE</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ ¹æ®æ–°å®¹é‡åˆ›å»ºå‡ºæ–°æ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>Entry</span><span class=o>[]</span> <span class=n>newTable</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Entry</span><span class=o>[</span><span class=n>newCapacity</span><span class=o>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å°†æ—§æ•°ç»„çš„èŠ‚ç‚¹è½¬ç§»åˆ°æ–°æ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>transfer</span><span class=o>(</span><span class=n>newTable</span><span class=o>,</span> <span class=n>initHashSeedAsNeeded</span><span class=o>(</span><span class=n>newCapacity</span><span class=o>));</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ–°æ—§æ˜“ä¸»  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>table</span> <span class=o>=</span> <span class=n>newTable</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ ¹æ®æ–°å®¹é‡é‡æ–°ç¡®å®šæ–°é˜ˆå€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=n>threshold</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span><span class=n>Math</span><span class=o>.</span><span class=na>min</span><span class=o>(</span><span class=n>newCapacity</span> <span class=o>*</span> <span class=n>loadFactor</span><span class=o>,</span> <span class=n>MAXIMUM_CAPACITY</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// ä»é…ç½®ä¸­è·å–æ˜¯å¦å¯ç”¨å¤‡ç”¨ hashï¼Œç”¨äºå‡å°‘å­—ç¬¦ä¸² hash å†²çª  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>final</span> <span class=kt>boolean</span> <span class=nf>initHashSeedAsNeeded</span><span class=o>(</span><span class=kt>int</span> <span class=n>capacity</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ˜¯å¦å·²ç»å¯ç”¨å¤‡ç”¨ hash  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>boolean</span> <span class=n>currentAltHashing</span> <span class=o>=</span> <span class=n>hashSeed</span> <span class=o>!=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è™šæ‹Ÿæœºå·²ç»å¯åŠ¨ä¸”æ•°ç»„å®¹é‡å¤§äº ALTERNATIVE_HASHING_THRESHOLD  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>boolean</span> <span class=n>useAltHashing</span> <span class=o>=</span> <span class=n>sun</span><span class=o>.</span><span class=na>misc</span><span class=o>.</span><span class=na>VM</span><span class=o>.</span><span class=na>isBooted</span><span class=o>()</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>(</span><span class=n>capacity</span> <span class=o>&gt;=</span> <span class=n>Holder</span><span class=o>.</span><span class=na>ALTERNATIVE_HASHING_THRESHOLD</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¼‚æˆ–æ“ä½œåˆ¤æ–­æ˜¯å¦åˆ‡æ¢  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=kt>boolean</span> <span class=n>switching</span> <span class=o>=</span> <span class=n>currentAltHashing</span> <span class=o>^</span> <span class=n>useAltHashing</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>switching</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// useAltHashing ä¸º true åˆ™ hashSeed åˆå§‹åŒ–ä¸ºä¹Ÿç»™éšæœº hash å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>hashSeed</span> <span class=o>=</span> <span class=n>useAltHashing</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>?</span> <span class=n>sun</span><span class=o>.</span><span class=na>misc</span><span class=o>.</span><span class=na>Hashing</span><span class=o>.</span><span class=na>randomHashSeed</span><span class=o>(</span><span class=k>this</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>:</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=n>switching</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>transfer</span><span class=o>(</span><span class=n>Entry</span><span class=o>[]</span> <span class=n>newTable</span><span class=o>,</span> <span class=kt>boolean</span> <span class=n>rehash</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>newCapacity</span> <span class=o>=</span> <span class=n>newTable</span><span class=o>.</span><span class=na>length</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// éå†æ—§æ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>:</span> <span class=n>table</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// éå†æ•°ç»„ä¸Šçš„é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>while</span><span class=o>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// è®°å½•ä¸‹ä¸€ä¸ªä½ç½®  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>next</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åˆ¤æ–­æ˜¯å¦é‡æ–°è®¡ç®— hash å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>rehash</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>=</span> <span class=kc>null</span> <span class=o>==</span> <span class=n>e</span><span class=o>.</span><span class=na>key</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=n>hash</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// æ ¹æ®æ–°å®¹é‡é‡æ–°è®¡ç®—ä½ç½®  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>indexFor</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span><span class=o>,</span> <span class=n>newCapacity</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// æŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// å› æ­¤æ‰©å®¹åå¯èƒ½å‡ºç°é€†åº  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=n>newTable</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>newTable</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span> <span class=o>=</span> <span class=n>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#æ‰©å®¹æµç¨‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæ‚£><h3 id=æ‰©å®¹æµç¨‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæ‚£><span class=hanchor arialabel=Anchor># </span>æ‰©å®¹æµç¨‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„éšæ‚£</h3></a><p>åœ¨ resize æ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œåœ¨å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®è½¬ç§»åˆ°æ–°æ•°ç»„ä¸Šæ—¶ï¼Œè½¬ç§»æ•°æ®æ“ä½œæ˜¯æŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥çš„ã€‚åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œç”±äºè¿™äº›æ“ä½œä¸å…·æœ‰åŸå­æ€§å’Œå†…å­˜å¯è§æ€§ï¼Œè½¬ç§»æ•°æ®ã€æ‰©å®¹åï¼Œå®¹æ˜“å‡ºç°ç¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚</p><a href=#java-8-æ‰©å®¹æµç¨‹><h2 id=java-8-æ‰©å®¹æµç¨‹><span class=hanchor arialabel=Anchor># </span>Java 8 æ‰©å®¹æµç¨‹</h2></a><a href=#ä»£ç åˆ†æ-3><h3 id=ä»£ç åˆ†æ-3><span class=hanchor arialabel=Anchor># </span>ä»£ç åˆ†æ</h3></a><p>Java 8 ä¸­çš„ resize å’Œ treeifyBin æ–¹æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>final</span> <span class=kt>void</span> <span class=nf>treeifyBin</span><span class=o>(</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=n>tab</span><span class=o>,</span> <span class=kt>int</span> <span class=n>hash</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>n</span><span class=o>,</span> <span class=n>index</span><span class=o>;</span> <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// å¦‚æœæ•°ç»„ä¸ºç©ºæˆ–è€…æ•°ç»„é•¿åº¦å°äº 64ï¼Œåˆ™è¿›è¡Œæ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>tab</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=o>(</span><span class=n>n</span> <span class=o>=</span> <span class=n>tab</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=o>&lt;</span> <span class=n>MIN_TREEIFY_CAPACITY</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>resize</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// æ ¹æ® hash è·å–æ•°ç»„ä¸‹æ ‡ï¼Œè¯¥ä½ç½®æœ‰å€¼å†è¿›è¡Œæ ‘åŒ–  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>tab</span><span class=o>[</span><span class=n>index</span> <span class=o>=</span> <span class=o>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>)</span> <span class=o>&amp;</span> <span class=n>hash</span><span class=o>])</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>hd</span> <span class=o>=</span> <span class=kc>null</span><span class=o>,</span> <span class=n>tl</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// éå†é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>do</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// Node èŠ‚ç‚¹è½¬æ¢æˆ TreeNode èŠ‚ç‚¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>p</span> <span class=o>=</span> <span class=n>replacementTreeNode</span><span class=o>(</span><span class=n>e</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>tl</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hd</span> <span class=o>=</span> <span class=n>p</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>p</span><span class=o>.</span><span class=na>prev</span> <span class=o>=</span> <span class=n>tl</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>tl</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=n>p</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>tl</span> <span class=o>=</span> <span class=n>p</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span> <span class=k>while</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â 
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>tab</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=n>hd</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hd</span><span class=o>.</span><span class=na>treeify</span><span class=o>(</span><span class=n>tab</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=nf>resize</span><span class=o>()</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=n>oldTab</span> <span class=o>=</span> <span class=n>table</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>oldCap</span> <span class=o>=</span> <span class=o>(</span><span class=n>oldTab</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=n>oldTab</span><span class=o>.</span><span class=na>length</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>oldThr</span> <span class=o>=</span> <span class=n>threshold</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>newCap</span><span class=o>,</span> <span class=n>newThr</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>oldCap</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// è¶…è¿‡æœ€å¤§å€¼åç»­ä¸å†æ‰©å®¹  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>oldCap</span> <span class=o>&gt;=</span> <span class=n>MAXIMUM_CAPACITY</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>threshold</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>MAX_VALUE</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>oldTab</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// å¦åˆ™æ‰©å……ä¸ºåŸæ¥çš„2å€  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>((</span><span class=n>newCap</span> <span class=o>=</span> <span class=n>oldCap</span> <span class=o>&lt;&lt;</span> <span class=n>1</span><span class=o>)</span> <span class=o>&lt;</span> <span class=n>MAXIMUM_CAPACITY</span> <span class=o>&amp;&amp;</span> <span class=n>oldCap</span> <span class=o>&gt;=</span> <span class=n>DEFAULT_INITIAL_CAPACITY</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>newThr</span> <span class=o>=</span> <span class=n>oldThr</span> <span class=o>&lt;&lt;</span> <span class=n>1</span><span class=o>;</span> <span class=c1>// double threshold  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>oldThr</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=c1>// initial capacity was placed in threshold  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>newCap</span> <span class=o>=</span> <span class=n>oldThr</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// signifies using defaults  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=n>newCap</span> <span class=o>=</span> <span class=n>DEFAULT_INITIAL_CAPACITY</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>newThr</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)(</span><span class=n>DEFAULT_LOAD_FACTOR</span> <span class=o>*</span> <span class=n>DEFAULT_INITIAL_CAPACITY</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// è®¡ç®—æ–°çš„ resize ä¸Šé™  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>newThr</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=kt>float</span> <span class=n>ft</span> <span class=o>=</span> <span class=o>(</span><span class=kt>float</span><span class=o>)</span><span class=n>newCap</span> <span class=o>*</span> <span class=n>loadFactor</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>newThr</span> <span class=o>=</span> <span class=o>(</span><span class=n>newCap</span> <span class=o>&lt;</span> <span class=n>MAXIMUM_CAPACITY</span> <span class=o>&amp;&amp;</span> <span class=n>ft</span> <span class=o>&lt;</span> <span class=o>(</span><span class=kt>float</span><span class=o>)</span><span class=n>MAXIMUM_CAPACITY</span> <span class=o>?</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span><span class=n>ft</span> <span class=o>:</span> <span class=n>Integer</span><span class=o>.</span><span class=na>MAX_VALUE</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>threshold</span> <span class=o>=</span> <span class=n>newThr</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=nd>@SuppressWarnings</span><span class=o>({</span><span class=s>&#34;rawtypes&#34;</span><span class=o>,</span><span class=s>&#34;unchecked&#34;</span><span class=o>})</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=n>newTab</span> <span class=o>=</span> <span class=o>(</span><span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[])</span><span class=k>new</span> <span class=n>Node</span><span class=o>[</span><span class=n>newCap</span><span class=o>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>table</span> <span class=o>=</span> <span class=n>newTab</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>oldTab</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// æ—§æ•°ç»„è¿ç§»è‡³æ–°æ•°ç»„  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>oldCap</span><span class=o>;</span> <span class=o>++</span><span class=n>j</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>oldTab</span><span class=o>[</span><span class=n>j</span><span class=o>])</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>oldTab</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>next</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>newTab</span><span class=o>[</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>&amp;</span> <span class=o>(</span><span class=n>newCap</span> <span class=o>-</span> <span class=n>1</span><span class=o>)]</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>e</span> <span class=k>instanceof</span> <span class=n>TreeNode</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;)</span><span class=n>e</span><span class=o>).</span><span class=na>split</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=n>newTab</span><span class=o>,</span> <span class=n>j</span><span class=o>,</span> <span class=n>oldCap</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>loHead</span> <span class=o>=</span> <span class=kc>null</span><span class=o>,</span> <span class=n>loTail</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>hiHead</span> <span class=o>=</span> <span class=kc>null</span><span class=o>,</span> <span class=n>hiTail</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>do</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>next</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åŸç´¢å¼•  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>&amp;</span> <span class=n>oldCap</span><span class=o>)</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>loTail</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>loHead</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>loTail</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>loTail</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åŸç´¢å¼•+oldCap  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>hiTail</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hiHead</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>else</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hiTail</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hiTail</span> <span class=o>=</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span> <span class=k>while</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>next</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åŸç´¢å¼•å…ƒç´ æ”¾åˆ°æ–°æ•°ç»„ä¸­  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>loTail</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>loTail</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>newTab</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>loHead</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// åŸç´¢å¼• +oldCap å…ƒç´ æ”¾åˆ°æ–°æ•°ç»„ä¸­  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>hiTail</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>hiTail</span><span class=o>.</span><span class=na>next</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>newTab</span><span class=o>[</span><span class=n>j</span> <span class=o>+</span> <span class=n>oldCap</span><span class=o>]</span> <span class=o>=</span> <span class=n>hiHead</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=n>newTab</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><p>resize æ–¹æ³•ä¸­çš„å‰åŠæ®µï¼Œå…³äº newCap å’Œ newThr çš„è®¡ç®—è¿‡ç¨‹ï¼Œç®€åŒ–åå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>oldCap</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// åµŒå¥—æ¡ä»¶åˆ†æ”¯  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>oldCap</span> <span class=o>&gt;=</span> <span class=n>MAXIMUM_CAPACITY</span><span class=o>)</span> <span class=o>{...}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>else</span> <span class=k>if</span> <span class=o>((</span><span class=n>newCap</span> <span class=o>=</span> <span class=n>oldCap</span> <span class=o>&lt;&lt;</span> <span class=n>1</span><span class=o>)</span> <span class=o>&lt;</span> <span class=n>MAXIMUM_CAPACITY</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>oldCap</span> <span class=o>&gt;=</span> <span class=n>DEFAULT_INITIAL_CAPACITY</span><span class=o>)</span> <span class=o>{...}</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>Â   
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>oldThr</span> <span class=o>&gt;</span> <span class=n>0</span><span class=o>)</span> <span class=o>{...}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=o>{...}</span>  
</span></span></code></pre></td></tr></table></div></div><p>è¿™äº›åˆ¤æ–­åˆ†åˆ«å¯¹åº”ä»¥ä¸‹å‡ ç§æ¡ä»¶ï¼š</p><table><thead><tr><th>æ¡ä»¶Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th><th>è¦†ç›–æƒ…å†µÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th><th>å¤‡æ³¨Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th></tr></thead><tbody><tr><td>oldCap > 0Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td><td>æ¡¶æ•°ç»„ table å·²ç»è¢«åˆå§‹åŒ–Â Â Â Â Â Â Â Â Â Â Â </td><td>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr><tr><td>oldThr > 0Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td><td>threshold > 0ï¼Œä¸”æ¡¶æ•°ç»„æœªè¢«åˆå§‹åŒ–Â Â Â </td><td>è°ƒç”¨ HashMap(int) å’Œ HashMap(int, float) æ„é€ æ–¹æ³•æ—¶ä¼šäº§ç”Ÿè¿™ç§æƒ…å†µï¼Œæ­¤ç§æƒ…å†µä¸‹ newCap = oldThrï¼ŒnewThr åœ¨ç¬¬äºŒä¸ªæ¡ä»¶åˆ†æ”¯ä¸­ç®—å‡º</td></tr><tr><td>oldCap <mark>0 && oldThr</mark> 0</td><td>æ¡¶æ•°ç»„æœªè¢«åˆå§‹åŒ–ï¼Œä¸” threshold ä¸º 0</td><td>è°ƒç”¨ HashMap() æ„é€ æ–¹æ³•ä¼šäº§ç”Ÿè¿™ç§æƒ…å†µã€‚Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr></tbody></table><p>oldCap > 0 æ—¶è¡¨ç¤º table æ•°ç»„å·²ç»è¢«åˆå§‹åŒ–è¿‡ï¼Œè¿™æ—¶éœ€è¦å†æ¬¡è®¡ç®—å®¹é‡å’Œé˜ˆå€¼ï¼š</p><table><thead><tr><th>æ¡ä»¶Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th><th>è¦†ç›–æƒ…å†µÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th><th>å¤‡æ³¨Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </th></tr></thead><tbody><tr><td>oldCap >= 230Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td><td>æ¡¶æ•°ç»„å®¹é‡å¤§äºæˆ–ç­‰äºæœ€å¤§æ¡¶å®¹é‡ 230Â Â Â Â Â Â Â Â Â Â Â Â </td><td>åç»­ä¸å†æ‰©å®¹Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td></tr><tr><td>newCap &lt; 230 && oldCap > 16</td><td>æ–°æ¡¶æ•°ç»„å®¹é‡å°äºæœ€å¤§å€¼ï¼Œä¸”æ—§æ¡¶æ•°ç»„å®¹é‡å¤§äº 16</td><td>è¯¥ç§æƒ…å†µä¸‹æ–°é˜ˆå€¼ newThr = oldThr &#171; 1ï¼Œç§»ä½å¯èƒ½ä¼šå¯¼è‡´æº¢å‡º</td></tr></tbody></table><p>resize æ–¹æ³•åç»­è¿‡ç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼ŒJava 8 è½¬ç§»æ•°æ®æ“ä½œæ˜¯æŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å°¾éƒ¨ä¾æ¬¡æ’å…¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°é“¾è¡¨ é€†åºã€å€’ç½®çš„æƒ…å†µï¼Œæ•…ä¸å®¹æ˜“å‡ºç°ç¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚ä½†ä»ç„¶è¿˜æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œå› ä¸ºæ²¡æœ‰åŠ åŒæ­¥é”ä¿æŠ¤ã€‚</p><a href=#æ‰©å®¹æµç¨‹å¯¹æ¯”><h2 id=æ‰©å®¹æµç¨‹å¯¹æ¯”><span class=hanchor arialabel=Anchor># </span>æ‰©å®¹æµç¨‹å¯¹æ¯”</h2></a><p><img src=https://my-bucket-1251125515.cos.ap-guangzhou.myqcloud.com/HashMap/clipboard_20230322_040805.png width=auto alt></p><a href=#get-æµç¨‹åˆ†æ><h1 id=get-æµç¨‹åˆ†æ><span class=hanchor arialabel=Anchor># </span>get æµç¨‹åˆ†æ</h1></a><a href=#java-7-1><h2 id=java-7-1><span class=hanchor arialabel=Anchor># </span>Java 7</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>getForNullKey</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>entry</span> <span class=o>=</span> <span class=n>getEntry</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span> <span class=o>==</span> <span class=n>entry</span> <span class=o>?</span> <span class=kc>null</span> <span class=o>:</span> <span class=n>entry</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=n>V</span> <span class=nf>getForNullKey</span><span class=o>()</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>size</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=c1>// ä¸‹æ ‡ä¸º 0 å¤„è·å– key ä¸º null çš„å…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>table</span><span class=o>[</span><span class=n>0</span><span class=o>];</span> <span class=n>e</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>e</span><span class=o>.</span><span class=na>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=nf>getEntry</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>size</span> <span class=o>==</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>hash</span> <span class=o>=</span> <span class=o>(</span><span class=n>key</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>for</span> <span class=o>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>table</span><span class=o>[</span><span class=n>indexFor</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>table</span><span class=o>.</span><span class=na>length</span><span class=o>)];</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>e</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>;</span> <span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>Object</span> <span class=n>k</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span> <span class=o>(</span><span class=n>key</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>))))</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#java-8-1><h2 id=java-8-1><span class=hanchor arialabel=Anchor># </span>Java 8</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=o>(</span><span class=n>e</span> <span class=o>=</span> <span class=n>getNode</span><span class=o>(</span><span class=n>hash</span><span class=o>(</span><span class=n>key</span><span class=o>),</span> <span class=n>key</span><span class=o>))</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=kc>null</span> <span class=o>:</span> <span class=n>e</span><span class=o>.</span><span class=na>value</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=nf>getNode</span><span class=o>(</span><span class=kt>int</span> <span class=n>hash</span><span class=o>,</span> <span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;[]</span> <span class=n>tab</span><span class=o>;</span> <span class=n>Node</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>first</span><span class=o>,</span> <span class=n>e</span><span class=o>;</span> <span class=kt>int</span> <span class=n>n</span><span class=o>;</span> <span class=n>K</span> <span class=n>k</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>tab</span> <span class=o>=</span> <span class=n>table</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>(</span><span class=n>n</span> <span class=o>=</span> <span class=n>tab</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=o>&gt;</span> <span class=n>0</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>(</span><span class=n>first</span> <span class=o>=</span> <span class=n>tab</span><span class=o>[(</span><span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>)</span> <span class=o>&amp;</span> <span class=n>hash</span><span class=o>])</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=c1>// å…ˆåˆ¤æ–­ tab[index] ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´   
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>first</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span> <span class=c1>// always check first node  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>first</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span> <span class=o>(</span><span class=n>key</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>))))</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>first</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>first</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=c1>// ç»“ç‚¹ä¸ºçº¢é»‘æ ‘åˆ™ä½¿ç”¨ TreeNode çš„æ–¹æ³•è·å–  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>first</span> <span class=k>instanceof</span> <span class=n>TreeNode</span><span class=o>)</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=o>((</span><span class=n>TreeNode</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span><span class=n>V</span><span class=o>&gt;)</span><span class=n>first</span><span class=o>).</span><span class=na>getTreeNode</span><span class=o>(</span><span class=n>hash</span><span class=o>,</span> <span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>do</span> <span class=o>{</span> <span class=c1>//å¦åˆ™éå†é“¾è¡¨  
</span></span></span><span class=line><span class=cl><span class=c1></span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>hash</span> <span class=o>==</span> <span class=n>hash</span> <span class=o>&amp;&amp;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>k</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>key</span><span class=o>)</span> <span class=o>==</span> <span class=n>key</span> <span class=o>||</span> <span class=o>(</span><span class=n>key</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>k</span><span class=o>))))</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>e</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>}</span> <span class=k>while</span> <span class=o>((</span><span class=n>e</span> <span class=o>=</span> <span class=n>e</span><span class=o>.</span><span class=na>next</span><span class=o>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div><p>éå†æ–¹å¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;()</span> <span class=o>{{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>put</span><span class=o>(</span><span class=s>&#34;a&#34;</span><span class=o>,</span> <span class=n>10</span><span class=o>);</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>put</span><span class=o>(</span><span class=s>&#34;b&#34;</span><span class=o>,</span> <span class=n>20</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}};</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=c1>// æ–¹å¼ä¸€ï¼šè¿­ä»£ entrySet  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=o>(</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>entry</span> <span class=o>:</span> <span class=n>map</span><span class=o>.</span><span class=na>entrySet</span><span class=o>())</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=na>getKey</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ–¹å¼äºŒï¼šå•ç‹¬è¿­ä»£ keySet æˆ– values  
</span></span></span><span class=line><span class=cl><span class=c1>// è¿­ä»£é”®  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>key</span> <span class=o>:</span> <span class=n>map</span><span class=o>.</span><span class=na>keySet</span><span class=o>())</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Key = &#34;</span> <span class=o>+</span> <span class=n>key</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=c1>// è¿­ä»£å€¼  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=o>(</span><span class=n>Integer</span> <span class=n>value</span> <span class=o>:</span> <span class=n>map</span><span class=o>.</span><span class=na>values</span><span class=o>())</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Value = &#34;</span> <span class=o>+</span> <span class=n>value</span><span class=o>);</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ–¹å¼ä¸‰ï¼šä½¿ç”¨ iterator  
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl><span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;&gt;</span> <span class=n>entries</span> <span class=o>=</span>Â Â Â Â Â Â Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â <span class=n>map</span><span class=o>.</span><span class=na>entrySet</span><span class=o>().</span><span class=na>iterator</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>(</span><span class=n>entries</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>entry</span> <span class=o>=</span> <span class=n>entries</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=na>getKey</span><span class=o>();</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=n>entry</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ–¹å¼å››ï¼šLambda è¡¨è¾¾å¼  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>map</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>k</span><span class=o>,</span> <span class=n>v</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;key: &#34;</span> <span class=o>+</span> <span class=n>k</span> <span class=o>+</span> <span class=s>&#34; value:&#34;</span> <span class=o>+</span> <span class=n>v</span><span class=o>));</span>  
</span></span></code></pre></td></tr></table></div></div><a href=#é¢è¯•é¢˜><h1 id=é¢è¯•é¢˜><span class=hanchor arialabel=Anchor># </span>é¢è¯•é¢˜</h1></a><a href=#ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„é•¿åº¦ä¸º-2-çš„å¹‚æ¬¡æ–¹><h2 id=ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„é•¿åº¦ä¸º-2-çš„å¹‚æ¬¡æ–¹><span class=hanchor arialabel=Anchor># </span>ä¸ºä»€ä¹ˆ HashMap æ•°ç»„é•¿åº¦ä¸º 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿ</h2></a><p>å¦‚æœæ•°ç»„ä¸­ hash å†²çªå¤ªè¿‡é¢‘ç¹ï¼ŒæŸäº›ä½ç½®çš„å…ƒç´ å½¢æˆè¿‡é•¿çš„é“¾è¡¨ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®å­˜å–æ•ˆç‡è¿‡ä½ï¼Œå› æ­¤è¦ä½¿å…ƒç´ å‡åŒ€åœ°åˆ†å¸ƒåœ¨æ•°ç»„ä¸­ï¼Œhash ç¢°æ’å°±ä¸èƒ½å¤ªé¢‘ç¹ã€‚è€Œ hash å€¼èŒƒå›´ä¸º -2147483648 åˆ° 2147483647ï¼Œå¦‚æœç”¨å¦‚æ­¤é•¿çš„æ•°ç»„æ¥è¿›è¡Œå­˜æ”¾åŠ ä¸Šåˆç† hash æ˜ å°„ç¡®å®å¯ä»¥ä½¿ hash ç¢°æ’é™åˆ°å¾ˆä½çš„æ°´å¹³ï¼Œä½†è¿™æ˜æ˜¾æ˜¯ä¸ç°å®çš„ã€‚</p><p>å› æ­¤è¿™ä¸ª hash å€¼æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œé¦–å…ˆéœ€è¦è¿›è¡ŒäºŒæ¬¡ hash ä½¿å¾—ç»“æœæ›´åŠ éšæœºï¼Œè¿™æ—¶ç†è®ºä¸Šå¯ä»¥ä½¿ç”¨ hash % length å¾—åˆ°ä¸€ä¸ªä¸å°äºæ•°ç»„é•¿åº¦ length çš„ index å€¼ï¼Œè¿™æ ·ä¸ä½†èƒ½é¿å…äº§ç”Ÿæ•°ç»„è¶Šç•Œï¼Œå¹¶ä¸”å¯ä»¥ä½¿å…ƒç´ å‡åŒ€åˆ†å¸ƒï¼Œäº‹å®ä¸Šå¾ˆå¤š hash ç®—æ³•éƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ã€‚ä½†æ˜¯åœ¨è®¡ç®—æœºä¸­ï¼Œ% å–æ¨¡è¿ç®—æ¯”ä½ & è¿ç®—çš„æ•ˆç‡è¦ä½å¾—å¤šï¼Œè€Œå½“ length ä¸º 2 çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œhash % length åˆšå¥½ç­‰äº hash & (length - 1) ï¼Œä»è€Œèƒ½å¤Ÿå°† % è¿ç®—è½¬æ¢æˆ & è¿ç®—ï¼Œæ›´åŠ å¿«é€Ÿåœ°å¾—åˆ° index å€¼ã€‚</p><p>å› æ­¤é‡‡ç”¨ 2 çš„å¹‚æ¬¡æ–¹ä½œä¸ºæ•°ç»„çš„é•¿åº¦çš„å¥½å¤„æ˜¯ï¼šä½¿å…ƒç´ å‡åŒ€åˆ†éƒ¨ä»¥é™ä½ hash å†²çªçš„åŸºç¡€ä¸Šï¼Œå¤§å¤§åŠ å¿«äº†è®¡ç®—å…ƒç´ æ‰€åœ¨æ•°ç»„ä½ç½®çš„é€Ÿåº¦ã€‚</p><a href=#hash-å†²çªæœ‰å“ªäº›è§£å†³æ–¹æ³•hashmap-æ˜¯æ€æ ·è§£å†³çš„><h2 id=hash-å†²çªæœ‰å“ªäº›è§£å†³æ–¹æ³•hashmap-æ˜¯æ€æ ·è§£å†³çš„><span class=hanchor arialabel=Anchor># </span>hash å†²çªæœ‰å“ªäº›è§£å†³æ–¹æ³•ï¼ŸHashMap æ˜¯æ€æ ·è§£å†³çš„ï¼Ÿ</h2></a><p>1.Â äºŒæ¬¡ hashï¼Œé€šè¿‡é«˜ 16 ä½ä¸ä½ 16 ä½å¼‚æˆ–è¿ç®—ï¼Œä½¿å¾—ç»“æœæ›´åŠ éšæœºï¼›<br>2.Â æ‹‰é“¾åœ°å€æ³•ï¼Œå°† hash å€¼ç›¸åŒçš„å…ƒç´ ä¸²æˆä¸€ä¸ªé“¾è¡¨æˆ–è€…è½¬ä¸ºçº¢é»‘æ ‘ã€‚</p><a href=#hashmap-ä¼šé€ æˆå“ªäº›å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³><h2 id=hashmap-ä¼šé€ æˆå“ªäº›å®‰å…¨é—®é¢˜æ€ä¹ˆè§£å†³><span class=hanchor arialabel=Anchor># </span>HashMap ä¼šé€ æˆå“ªäº›å®‰å…¨é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h2></a><p>å¦‚å‰é¢æ–‡ç« æ‰€è¿°ï¼Œåœ¨ Java 7 ä¸­ï¼ŒHashMap åœ¨æ‰©å®¹çš„æ—¶å€™æ˜¯é€šè¿‡éå†æ—§æ•°ç»„ï¼Œç„¶ååœ¨æ–°æ•°ç»„ä¸­ä½¿ç”¨å¤´æ’æ³•è¿›è¡Œè½¬ç§»å…ƒç´ çš„ã€‚è¿™åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åˆ°äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç”±äº JMM çš„ç‰¹æ€§ï¼Œä¼šä»¥ä¸€å®šçš„æ¦‚ç‡å½¢æˆç¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚åœ¨ Java 8 ä¸­è¿™ä¸ªé—®é¢˜é€šè¿‡ä½¿ç”¨å°¾æ’æ³•å¾—åˆ°è§£å†³ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸‹å¾ˆå¤šæ“ä½œä»ç„¶ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹ put åæŸäº›å…ƒç´ ä¸¢å¤±ç­‰ã€‚å› æ­¤å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ ConcurentHashMap ä»£æ›¿ HashMapã€‚</p><a href=#ä½¿ç”¨å¯¹è±¡ä½œä¸º-hashmap-çš„-key-åº”è¯¥æ³¨æ„ä»€ä¹ˆ><h2 id=ä½¿ç”¨å¯¹è±¡ä½œä¸º-hashmap-çš„-key-åº”è¯¥æ³¨æ„ä»€ä¹ˆ><span class=hanchor arialabel=Anchor># </span>ä½¿ç”¨å¯¹è±¡ä½œä¸º HashMap çš„ key åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿ</h2></a><p>åº”å½“é‡å†™å¯¹è±¡çš„ hashCode() å’Œ equals() æ–¹æ³•ã€‚å¦‚å‰é¢ä»£ç æ‰€ç¤ºï¼ŒHashMap åœ¨ put ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ­¤å…ƒç´ çš„ key å€¼çš„ hashCode æ–¹æ³•ç¡®å®šå…ƒç´ å­˜æ”¾ä½ç½®ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨ hashCode å’Œ equals æ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚å› æ­¤å¦‚æœæ²¡æœ‰é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ–è€…æ–¹æ³•é‡å†™çš„æ—¶å€™æ²¡æœ‰éµå®ˆè§„åˆ™ï¼ŒHashMap é€šè¿‡ put å­˜å…¥ä¸€ç»„å…ƒç´ åï¼Œå†é€šè¿‡æ­¤å…ƒç´ çš„ key å€¼å» get å¯¹è±¡çš„æ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°è·Ÿé¢„æœŸç»“æœä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>åœ¨é‡å†™ equals æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦éµå®ˆä¸‹é¢çš„é€šç”¨çº¦å®šï¼š</p><p>-Â <strong>è‡ªåæ€§</strong>ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨ xï¼Œx.equals(x) å¿…é¡»è¿”å› trueï¼›<br>-Â <strong>å¯¹ç§°æ€§</strong>ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨ x å’Œ yï¼Œå¦‚æœä¸”ä»…å½“ y.equals(x) è¿”å› true æ—¶ x.equals(y) å¿…é¡»è¿”å› trueï¼›<br>-Â <strong>ä¼ é€’æ€§</strong>ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨ xã€yã€zï¼Œå¦‚æœ x.equals(y) è¿”å› trueï¼Œy.equals(z) è¿”å› trueï¼Œåˆ™ x.equals(z) å¿…é¡»è¿”å› trueï¼›<br>-Â <strong>ä¸€è‡´æ€§</strong>ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨ x å’Œ yï¼Œå¦‚æœåœ¨ equals æ¯”è¾ƒä¸­ä½¿ç”¨çš„ä¿¡æ¯æ²¡æœ‰ä¿®æ”¹ï¼Œåˆ™ x.equals(y) çš„å¤šæ¬¡è°ƒç”¨å¿…é¡»å§‹ç»ˆè¿”å› true æˆ–å§‹ç»ˆè¿”å› falseï¼›<br>-Â <strong>éç©ºæ€§</strong>ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨ xï¼Œx.equals(null) å¿…é¡»è¿”å› falseã€‚</p><p><strong>é‡å†™ hashCode æ–¹æ³•çš„å¤§è‡´æ–¹å¼ï¼ˆéå¼ºåˆ¶ï¼‰ï¼š</strong></p><p>1.Â æŠŠæŸä¸ªéé›¶å¸¸æ•°å€¼ï¼Œæ¯”å¦‚è¯´ 31ï¼ˆæœ€å¥½æ˜¯ç´ æ•°ï¼Œè€ƒè™‘åˆ° HashMap æºç ä¸­çš„å¼‚æˆ–æ“ä½œï¼‰ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå« result çš„ int ç±»å‹çš„å˜é‡ä¸­ã€‚<br>2.Â å¯¹äºå¯¹è±¡ä¸­æ¯ä¸€ä¸ªå…³é”®åŸŸ fï¼ˆå€¼ equals æ–¹æ³•ä¸­è€ƒè™‘çš„æ¯ä¸€ä¸ªåŸŸï¼‰ï¼Œå®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š<br>3.Â ä¸ºè¯¥åŸŸè®¡ç®— int ç±»å‹çš„æ•£åˆ—ç  c:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. å¦‚æœè¯¥åŸŸæ˜¯ boolean ç±»å‹ï¼Œåˆ™è®¡ç®— (f?0:1)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>2. å¦‚æœè¯¥åŸŸæ˜¯ byteã€charã€short æˆ–è€… int ç±»å‹ï¼Œåˆ™è®¡ç®— (int)f  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>3. å¦‚æœè¯¥åŸŸæ˜¯ float ç±»å‹ï¼Œåˆ™è®¡ç®— Float.floatToIntBits(f)  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>4. å¦‚æœè¯¥åŸŸæ˜¯ long ç±»å‹ï¼Œåˆ™è®¡ç®— (int)(f ^ (f&gt;&gt;&gt;32))  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>5. å¦‚æœè¯¥åŸŸæ˜¯doubleç±»å‹ï¼Œåˆ™è®¡ç®— Double.doubleToLongBits(f) å¾—åˆ°ä¸€ä¸ª long ç±»å‹çš„å€¼ï¼Œç„¶åæŒ‰ç…§æ­¥éª¤ 4ï¼Œå¯¹è¯¥ long å‹å€¼è®¡ç®—æ•£åˆ—å€¼  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>6. å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥ç±»çš„ equals æ–¹æ³•é€šè¿‡é€’å½’è°ƒç”¨ equals çš„æ–¹å¼æ¥æ¯”è¾ƒè¿™ä¸ªåŸŸï¼Œåˆ™åŒæ ·å¯¹è¿™ä¸ªå¯¹è±¡é€’å½’è°ƒç”¨ hashCode æ–¹æ³•ã€‚  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>7. å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™æŠŠæ¯ä¸€ä¸ªå…ƒç´ å½“åšå•ç‹¬çš„åŸŸæ¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€’å½’åœ°åº”ç”¨ä¸Šè¿°è§„åˆ™ï¼Œå¯¹æ¯ä¸ªé‡è¦çš„å…ƒç´ è®¡ç®—ä¸€ä¸ªæ•£åˆ—ç ï¼Œç„¶åæ ¹æ®æ­¥éª¤ä¸‹é¢çš„åšæ³•æŠŠè¿™äº›æ•£åˆ—å€¼ç»„åˆèµ·æ¥ã€‚  
</span></span></code></pre></td></tr></table></div></div><p>2.Â æŒ‰ç…§ä¸‹é¢çš„å…¬å¼ï¼ŒæŠŠæ­¥éª¤ 1 ä¸­è®¡ç®—å¾—åˆ°çš„æ•£åˆ—ç  c ç»„åˆåˆ° result ä¸­ï¼šresult = 31 x result+cã€‚<br>3.Â è¿”å› resultã€‚<br>4.Â å†™å®Œ hashCode æ–¹æ³•ä¹‹åï¼Œç¡®è®¤æ˜¯å¦ç›¸ç­‰çš„å®ä¾‹å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚å¦‚æœä¸æ˜¯çš„è¯ï¼Œæ‰¾å‡ºåŸå› ï¼Œå¹¶ä¿®æ”¹ã€‚</p><p>æ ·ä¾‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Student</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>private</span> <span class=kt>int</span> <span class=n>age</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>private</span> <span class=n>Grades</span> <span class=n>grades</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>public</span> <span class=nf>Student</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=kt>int</span> <span class=n>age</span><span class=o>,</span> <span class=n>Grades</span> <span class=n>grades</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>age</span> <span class=o>=</span> <span class=n>age</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>this</span><span class=o>.</span><span class=na>grades</span> <span class=o>=</span> <span class=n>grades</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â Â Â Â <span class=nd>@Override</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=kd>final</span> <span class=kt>int</span> <span class=n>prime</span> <span class=o>=</span> <span class=n>31</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â 
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>result</span> <span class=o>=</span> <span class=n>prime</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span> <span class=n>age</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>result</span> <span class=o>=</span> <span class=n>prime</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>((</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=n>name</span><span class=o>.</span><span class=na>hashCode</span><span class=o>());</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>result</span> <span class=o>=</span> <span class=n>prime</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=o>(</span><span class=n>grades</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>0</span> <span class=o>:</span> <span class=n>grades</span><span class=o>.</span><span class=na>hashCode</span><span class=o>());</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=n>result</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=nd>@Override</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>)</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=k>this</span> <span class=o>==</span> <span class=n>obj</span><span class=o>)</span> <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>getClass</span><span class=o>()</span> <span class=o>!=</span> <span class=n>obj</span><span class=o>.</span><span class=na>getClass</span><span class=o>())</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=n>Student</span> <span class=n>other</span> <span class=o>=</span> <span class=o>(</span><span class=n>Student</span><span class=o>)</span> <span class=n>obj</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>age</span> <span class=o>!=</span> <span class=n>other</span><span class=o>.</span><span class=na>age</span><span class=o>)</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>name</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=o>!</span><span class=n>name</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>other</span><span class=o>.</span><span class=na>name</span><span class=o>)</span> <span class=o>:</span>Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>other</span><span class=o>.</span><span class=na>name</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>if</span> <span class=o>(</span><span class=n>grades</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=o>!</span><span class=n>grades</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>other</span><span class=o>.</span><span class=na>grades</span><span class=o>)</span> <span class=o>:</span>Â Â Â Â Â Â Â Â Â   
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class=n>other</span><span class=o>.</span><span class=na>grades</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>Â Â Â Â Â Â Â Â <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>  
</span></span><span class=line><span class=cl>Â Â Â Â <span class=o>}</span>  
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script async src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://www.guanpj.top/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by guanpj using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://www.guanpj.top/>Home</a></li><li><a href=https://twitter.com/guanpj>Twitter</a></li><li><a href=https://github.com/guanpj>GitHub</a></li></ul></footer></div></div></body></html>